# FANET Packet Types Reference

## Обзор типов пакетов

| Type | Name | Description | Priority |
|------|------|-------------|----------|
| 0 | ACK | Подтверждение | Low |
| 1 | Air Position | Позиция воздушного судна | High |
| 2 | Name | Имя пилота/устройства | Medium |
| 3 | Message | Текстовое сообщение | Low |
| 4 | Service | Сервисные данные (погода) | Medium |
| 5 | Landmark | Точка интереса | Low |
| 6 | Reserved | Зарезервировано | - |
| 7 | Ground Position | Позиция наземного объекта | High |
| 8 | Reserved | Зарезервировано | - |
| 9 | Thermal | Термический поток | Medium |
| 10 | Container | Контейнер данных | Low |
| 11 | Reserved | Зарезервировано | - |
| 12 | Custom | Пользовательские данные | Low |

## Детальное описание

### Type 0: ACK (Acknowledgment)

**Назначение**: Подтверждение получения пакета  
**Использование**: Редко, только для критических сообщений  
**Обработка**: Логирование, не передается клиентам

### Type 1: Air Position

**Назначение**: Передача позиции летательного аппарата  
**Частота**: 1-10 Гц в зависимости от скорости  
**Критичность**: Высокая - основные данные для отображения

**Данные**:
- Координаты (lat/lon)
- Высота GPS
- Скорость относительно земли
- Вертикальная скорость (вариометр)
- Курс
- Тип летательного аппарата

**Обработка**:
1. Валидация координат и скорости
2. Обновление в Redis (pilot:<addr>)
3. Добавление в трек
4. Отправка WebSocket клиентам

### Type 2: Name

**Назначение**: Передача имени пилота или устройства  
**Частота**: При включении и каждые 5 минут  
**Критичность**: Средняя

**Данные**:
- UTF-8 строка (max 20 символов)
- Может содержать callsign или регистрацию

**Обработка**:
1. Сохранение в Redis (name:<addr>)
2. Обновление у всех связанных объектов
3. Кэширование на 24 часа

### Type 3: Message

**Назначение**: Текстовые сообщения между пилотами  
**Частота**: По требованию  
**Критичность**: Низкая

**Обработка**: В текущей версии игнорируется

### Type 4: Service

**Назначение**: Сервисные данные, в основном метеостанции  
**Частота**: Каждые 1-5 минут  
**Критичность**: Средняя

**Подтипы**:
- 0: Полные метеоданные
- 1: Только батарея
- 2: Статус ретранслятора

**Данные метеостанции**:
- Температура
- Влажность
- Давление
- Скорость и направление ветра
- Порывы ветра
- Заряд батареи

**Обработка**:
1. Сохранение в Redis (station:<addr>)
2. Добавление в историю метеоданных
3. Расчет трендов (опционально)

### Type 5: Landmark

**Назначение**: Метки на карте (стартовые площадки, опасности)  
**Частота**: Редко  
**Критичность**: Низкая

**Обработка**: Планируется в будущих версиях

### Type 7: Ground Position

**Назначение**: Позиция наземного транспорта или человека  
**Частота**: 0.1-1 Гц  
**Критичность**: Высокая для retrieve команд

**Данные**: Аналогично Type 1, но для наземных объектов

**Типы объектов**:
- 0: Пешеход
- 1: Автомобиль
- 2: Велосипед
- 3: Мотоцикл
- 4: Грузовик

**Обработка**:
1. Фильтрация по скорости (max 200 км/ч)
2. Сохранение отдельно от воздушных объектов
3. Короткий TTL (30 минут)

### Type 9: Thermal

**Назначение**: Информация о термических потоках  
**Частота**: При обнаружении качественного термика  
**Критичность**: Средняя

**Условия генерации**:
- Набор высоты > 1 м/с в течение 45 секунд
- Спиральный полет (изменение курса > 270°)
- Минимальная высота набора 50м

**Данные**:
- Координаты центра термика
- Средняя скороподъемность
- Высота рабочего диапазона
- Качество (0-5)
- Ветер на высоте

**Обработка**:
1. Дедупликация по координатам (радиус 500м)
2. Агрегация от разных пилотов
3. TTL 6 часов
4. Приоритет свежих данных

### Type 10: Container

**Назначение**: Контейнер для множественных данных  
**Использование**: Планируется для батчинга

### Type 12: Custom

**Назначение**: Расширения производителей  
**Обработка**: Логирование без парсинга

## Приоритеты обработки

### Высокий приоритет
1. Type 1 (Air Position) - основные данные
2. Type 7 (Ground Position) - retrieve команды
3. Emergency флаги в любом типе

### Средний приоритет
1. Type 9 (Thermal) - полезно для полета
2. Type 4 (Service) - метеоданные
3. Type 2 (Name) - идентификация

### Низкий приоритет
1. Type 3 (Message) - не критично
2. Type 5 (Landmark) - статичные данные
3. Type 0 (ACK) - служебные

## Фильтрация и валидация

### Временные фильтры
- Position пакеты старше 1 часа - отбрасывать
- Thermal старше 6 часов - отбрасывать
- Weather старше 30 минут - предупреждение

### Географические фильтры
- Проверка реалистичности перемещения
- Максимальная скорость между точками
- Геофенсинг для определенных регионов

### Частотные ограничения
- Position: max 10 Гц от одного устройства
- Name: max 1 раз в минуту
- Service: max 1 раз в 30 секунд